# MCP Server for Kubernetes Support Bundles

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](LICENSE)
[![Python Version](https://img.shields.io/badge/python-3.11%2B-blue)](https://www.python.org/downloads/)

A Model Context Protocol (MCP) server for AI models to interact with Kubernetes support bundles. This server enables AI models to analyze and troubleshoot Kubernetes clusters by exploring support bundles generated by the [Troubleshoot](https://troubleshoot.sh/) tool.

## Features

- ğŸš€ **Bundle Management**: Initialize and manage Kubernetes support bundles
- ğŸ® **Command Execution**: Run kubectl commands against bundle's API server
- ğŸ“ **File Explorer**: Navigate and search files within the bundle
- ğŸ” **Secure Authentication**: Token-based authentication for bundle access
- ğŸ³ **Docker Support**: Run as a containerized application

## Quick Start

### Using Docker

The easiest way to get started is using Docker:

```bash
# Build the image
./mcp-server-troubleshoot/scripts/build.sh

# Run the server
./mcp-server-troubleshoot/scripts/run.sh /path/to/bundles your-token
```

See the [Docker documentation](mcp-server-troubleshoot/DOCKER.md) for more details.

### Manual Installation

1. Ensure you have Python 3.11+ installed
2. Install the package:

```bash
# Using uv (recommended)
uv pip install -e ./mcp-server-troubleshoot

# Or using pip
pip install -e ./mcp-server-troubleshoot
```

3. Set up your authentication token:

```bash
export SBCTL_TOKEN=your-token
```

4. Run the server:

```bash
python -m mcp_server_troubleshoot
```

## Documentation

For comprehensive documentation, see:

- [User Guide](docs/user_guide.md): Installation, configuration, and usage
- [API Reference](docs/api_reference.md): Detailed API documentation
- [Developer Guide](docs/developer_guide.md): Information for developers
- [Example Prompts](docs/examples/prompt_examples.md): Sample AI prompts and responses
- [Troubleshooting Guide](docs/troubleshooting.md): Solutions for common issues
- [Docker Guide](mcp-server-troubleshoot/DOCKER.md): Container usage and configuration
- [System Architecture](docs/architecture.md): Overall system design

## Tools

The MCP server provides the following tools for AI models:

### Bundle Management

- `initialize_bundle`: Initialize a support bundle for use

### Kubectl Commands

- `kubectl`: Execute kubectl commands against the bundle

### File Operations

- `list_files`: List files and directories
- `read_file`: Read file contents
- `grep_files`: Search for patterns in files

## Example Usage

AI models can interact with the server using the MCP protocol:

```json
// Request to list files
{
  "name": "list_files",
  "input": {
    "path": "/kubernetes/pods",
    "recursive": false
  }
}

// Response (simplified)
{
  "content": "Listed files in /kubernetes/pods non-recursively:\n```json\n[\n  {\n    \"name\": \"kube-system\",\n    \"path\": \"/kubernetes/pods/kube-system\",\n    \"type\": \"directory\",\n    \"size\": null,\n    \"modified\": \"2025-04-10T12:30:45Z\"\n  },\n  {\n    \"name\": \"pod-definition.yaml\",\n    \"path\": \"/kubernetes/pods/pod-definition.yaml\",\n    \"type\": \"file\",\n    \"size\": 1254,\n    \"modified\": \"2025-04-10T12:30:45Z\"\n  }\n]\n```\nDirectory metadata:\n```json\n{\n  \"path\": \"/kubernetes/pods\",\n  \"recursive\": false,\n  \"total_files\": 1,\n  \"total_dirs\": 1\n}\n```"
}
```

## Project Structure

```
â”œâ”€â”€ docs/                      # Documentation
â”‚   â”œâ”€â”€ agentic/               # AI agent documentation
â”‚   â”œâ”€â”€ components/            # Component design docs
â”‚   â””â”€â”€ examples/              # Example prompts and usage
â”œâ”€â”€ examples/                  # Example configurations
â”‚   â””â”€â”€ mcp-servers/           # MCP server example configs
â”œâ”€â”€ mcp-server-troubleshoot/   # Main package
â”‚   â”œâ”€â”€ scripts/               # Utility scripts
â”‚   â”‚   â”œâ”€â”€ build.sh           # Docker build script
â”‚   â”‚   â””â”€â”€ run.sh             # Docker run script
â”‚   â”œâ”€â”€ src/                   # Source code
â”‚   â”‚   â””â”€â”€ mcp_server_troubleshoot/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ __main__.py    # Entry point
â”‚   â”‚       â”œâ”€â”€ bundle.py      # Bundle management
â”‚   â”‚       â”œâ”€â”€ cli.py         # CLI interface
â”‚   â”‚       â”œâ”€â”€ files.py       # File operations
â”‚   â”‚       â”œâ”€â”€ kubectl.py     # Kubectl command execution
â”‚   â”‚       â””â”€â”€ server.py      # MCP server implementation
â”‚   â””â”€â”€ tests/                 # Test files
â”‚       â”œâ”€â”€ e2e/               # End-to-end tests
â”‚       â”œâ”€â”€ fixtures/          # Test fixtures 
â”‚       â”œâ”€â”€ integration/       # Integration tests
â”‚       â””â”€â”€ unit/              # Unit tests
â””â”€â”€ tasks/                     # Task definitions
    â”œâ”€â”€ completed/             # Completed tasks
    â””â”€â”€ review/                # Tasks under review
```

## Requirements

- Python 3.11 or later
- `kubectl` command-line tool
- `sbctl` command-line tool for bundle management
- Token for authentication (set as `SBCTL_TOKEN` environment variable)

## Contributing

Contributions are welcome! Please see the [Developer Guide](docs/developer_guide.md) for details on how to contribute.

## License

This project is licensed under the Apache License 2.0 - see the [LICENSE](LICENSE) file for details.